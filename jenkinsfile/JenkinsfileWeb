@Library('jenkins-shared-cocos') _

pipeline {
  agent { label 'cocos-windows-agent' }
  environment {
    platform = 'web'
  }
  
  parameters {
    string(name: 'git_ref', defaultValue: 'main')
    choice(name: 'channel', choices: ['official'])
    choice(name: 'env', choices: ['dev', 'test', 'prod'])
    choice(name: 'mode', choices: ['release','debug'])
    booleanParam(name: 'clean', defaultValue: false)
  }

  stages {
    stage('Start') {
      steps { cocosPipeline(this) }
    }

    stage('Publish') {
      steps {
        publishArtifacts(this)
        updateManifest(this)
      }
    }
  }
}
